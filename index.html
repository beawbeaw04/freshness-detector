<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Freshness Detector AI</title>
    <style>
        body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; text-align: center; background-color: #f0f2f5; margin: 0; padding: 20px; }
        .container { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        #video-container { position: relative; width: 100%; border-radius: 15px; overflow: hidden; background: #000; line-height: 0; }
        video { width: 100%; height: auto; transform: scaleX(1); }
        .reticle { position: absolute; top: 50%; left: 50%; width: 40px; height: 40px; border: 3px solid white; transform: translate(-50%, -50%); border-radius: 50%; box-shadow: 0 0 10px rgba(0,0,0,0.5); pointer-events: none; }
        #result-card { margin-top: 20px; padding: 20px; border-radius: 15px; transition: 0.3s; }
        .status-text { font-size: 28px; font-weight: bold; margin: 0; }
        .rgb-info { font-size: 14px; color: #666; margin-top: 10px; }
        .color-preview { width: 50px; height: 50px; border-radius: 50%; margin: 10px auto; border: 2px solid #ddd; }
        button { background: #007bff; color: white; border: none; padding: 12px 25px; border-radius: 10px; font-size: 16px; margin-top: 15px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h2>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>
    <p>‡∏ô‡∏≥‡πÅ‡∏ú‡πà‡∏ô‡∏ü‡∏¥‡∏•‡πå‡∏°‡∏°‡∏≤‡∏à‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á</p>
    
    <div id="video-container">
        <video id="webcam" autoplay playsinline></video>
        <div class="reticle"></div>
    </div>

    <canvas id="canvas" style="display:none;"></canvas>

    <div id="result-card">
        <div id="color-circle" class="color-preview"></div>
        <p id="status" class="status-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á...</p>
        <p id="rgb-val" class="rgb-info">RGB: (0, 0, 0)</p>
    </div>
    
    <button onclick="location.reload()">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
</div>

<script>
    const video = document.getElementById('webcam');
    const canvas = document.getElementById('canvas');
    const statusText = document.getElementById('status');
    const rgbVal = document.getElementById('rgb-val');
    const resultCard = document.getElementById('result-card');
    const colorCircle = document.getElementById('color-circle');

    // 1. ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á
    async function startCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "environment", focusMode: "continuous" } 
            });
            video.srcObject = stream;
        } catch (err) {
            statusText.innerText = "‚ùå ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ";
            console.error(err);
        }
    }

    // 2. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏µ
    function processFrame() {
        if (video.readyState === video.HAVE_ENOUGH_DATA) {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d', { willReadFrequently: true });
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏¥‡∏Å‡πÄ‡∏ã‡∏•‡∏ï‡∏£‡∏á‡∏à‡∏∏‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á
            const x = canvas.width / 2;
            const y = canvas.height / 2;
            const pixel = ctx.getImageData(x, y, 1, 1).data;
            const r = pixel[0], g = pixel[1], b = pixel[2];

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            rgbVal.innerText = `‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ RGB: (${r}, ${g}, ${b})`;
            colorCircle.style.backgroundColor = `rgb(${r},${g},${b})`;

            // 3. ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏î (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏µ‡∏≠‡∏±‡∏ç‡∏ä‡∏±‡∏ô)
            // ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            if (b > r + 20 && b > g) { 
                // ‡∏™‡∏µ‡πÇ‡∏ó‡∏ô‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô/‡∏°‡πà‡∏ß‡∏á (‡∏™‡∏î)
                updateStatus("‚úÖ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏î‡∏°‡∏≤‡∏Å", "#d4edda", "#155724");
            } else if (g > r && g > b - 20) { 
                // ‡∏™‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß/‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á (‡πÄ‡∏™‡∏µ‡∏¢)
                updateStatus("‚ùå ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏ô‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢", "#f8d7da", "#721c24");
            } else {
                updateStatus("‚ö†Ô∏è ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô...", "#fff3cd", "#856404");
            }
        }
        requestAnimationFrame(processFrame);
    }

    function updateStatus(text, bgColor, textColor) {
        statusText.innerText = text;
        resultCard.style.backgroundColor = bgColor;
        statusText.style.color = textColor;
    }

    video.addEventListener('loadeddata', () => {
        statusText.innerText = "üîç ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏•‡πâ‡∏ß";
        processFrame();
    });

    startCamera();
</script>

</body>
</html>
